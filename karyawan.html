<!doctype html>
<html lang="id" class="no-js">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karyawan • Presensi FUPA</title>
  <meta name="theme-color" content="#2563EB" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --blue-600:#2563EB; --blue-400:#60A5FA; --blue-800:#1E40AF; --blue-300:#93C5FD;
      --text:#0B1220; --card:#0F172A; --divider:#E2E8F0;
      --ok:#16a34a; --late:#eab308; --abs:#ef4444;
      --glass: rgba(15,23,42,.72);
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#fff;background:#0b1022;overflow-x:hidden}
    .bg-animated{position:fixed;inset:0;z-index:-2}
    .bg-gradient{
      position:absolute; inset:0; z-index:-2;
      background:
        radial-gradient(1200px 800px at 20% 30%, rgba(147,197,253,.16), transparent 60%),
        radial-gradient(900px 600px at 80% 70%, rgba(96,165,250,.12), transparent 60%),
        linear-gradient(135deg, var(--blue-800), var(--blue-600), var(--blue-400));
      filter:saturate(1.1);
    }
    #bg-light{position:absolute;inset:0;z-index:-1;opacity:.5}
    @media (prefers-reduced-motion: reduce){#bg-light{display:none}}

    .appbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:rgba(15,23,42,.6);backdrop-filter:blur(8px);border-bottom:1px solid rgba(226,232,240,.12)}
    .brand{margin:0;font-size:18px}
    .server-time{font-variant-numeric:tabular-nums}
    .icon-btn{background:transparent;border:0;color:#fff;cursor:pointer;padding:6px;border-radius:10px}
    .icon-btn.badge{position:relative}
    .badge-dot{position:absolute;top:2px;right:2px;width:8px;height:8px;border-radius:999px;background:#f43f5e}
    .hidden{display:none !important}

    .container{padding:16px;max-width:1100px;margin:0 auto;display:grid;gap:16px}
    .card{background:rgba(15,23,42,.72);backdrop-filter: blur(8px);border:1px solid rgba(226,232,240,.12);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
    .card-header{padding:16px;border-bottom:1px solid rgba(226,232,240,.12)}
    .pane{padding:16px}
    h2,h3{margin:0 0 8px}
    .muted{color:rgba(255,255,255,.75)}
    .small{font-size:12px}
    .grid-2{display:grid;gap:16px;grid-template-columns:1fr}
    @media(min-width:800px){.grid-2{grid-template-columns:1fr 1fr}}
    .row{display:flex;align-items:center;gap:10px}
    .between{justify-content:space-between}
    .gap{gap:10px}
    .btn{display:inline-flex;align-items:center;gap:8px;justify-content:center;border:0;border-radius:12px;padding:12px 16px;cursor:pointer;color:#fff;background:linear-gradient(135deg,var(--blue-800),var(--blue-600),var(--blue-400));transition:filter .2s ease, transform .05s ease}
    .btn.outline{background:transparent;border:1px solid rgba(255,255,255,.24)}
    .btn.ghost{background:transparent}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .pulse{animation:pulse 3s ease-in-out infinite}
    @keyframes pulse{0%,100%{filter:saturate(1)}50%{filter:saturate(1.2) brightness(1.05)}}

    .mapbox{height:160px;background:rgba(255,255,255,.06);border:1px solid rgba(226,232,240,.18);border-radius:12px}
    .status-dot{font-size:14px;color:#93C5FD}
    .camera{position:relative;display:grid;place-items:center;background:rgba(255,255,255,.06);border:1px solid rgba(226,232,240,.18);border-radius:12px;overflow:hidden;height:220px}
    video{width:100%;height:100%;object-fit:cover}
    .photo-preview{width:100%;margin-top:8px;border-radius:12px;border:1px solid rgba(226,232,240,.18)}
    .segmented{display:inline-grid;grid-auto-flow:column;gap:6px;padding:6px;background:rgba(255,255,255,.06);border:1px solid rgba(226,232,240,.18);border-radius:999px}
    .segmented input{display:none}
    .segmented label{padding:8px 12px;border-radius:999px;cursor:pointer}
    .segmented input:checked + label{background:linear-gradient(135deg,var(--blue-800),var(--blue-600));}

    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid rgba(226,232,240,.18)}
    .chip.green{background:rgba(22,163,74,.15);border-color:rgba(22,163,74,.35)}
    .chip.yellow{background:rgba(234,179,8,.15);border-color:rgba(234,179,8,.35)}
    .chip.red{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.35)}
    .legend .dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin:0 6px 0 14px}
    .dot.green{background:#16a34a}.dot.yellow{background:#eab308}.dot.red{background:#ef4444}

    .timeline{display:grid;gap:10px}
    .item{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-radius:12px;background:rgba(255,255,255,.06);border:1px solid rgba(226,232,240,.18)}
    .item .meta{font-size:12px;color:rgba(255,255,255,.8)}

    .list{display:grid}
    .list .rowi{display:flex;justify-content:space-between;align-items:flex-start;gap:10px;padding:12px;border-bottom:1px solid rgba(226,232,240,.12)}
    .list .rowi.read{opacity:.6}

    .fab{position:fixed;right:18px;bottom:18px;z-index:12;border:0;border-radius:16px;padding:14px 16px;background:linear-gradient(135deg,var(--blue-800),var(--blue-600));color:#fff;box-shadow:var(--shadow);cursor:pointer}
    .modal{width:min(560px,92vw);border:1px solid rgba(226,232,240,.18);border-radius:16px;background:#0f172a;color:#fff}
    .modal::backdrop{background:rgba(0,0,0,.35);backdrop-filter: blur(2px)}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid rgba(226,232,240,.12)}
    .modal-body{padding:14px}
    .modal-footer{display:flex;align-items:center;gap:10px;justify-content:flex-end;padding:12px 14px;border-top:1px solid rgba(226,232,240,.12)}
    .avatar-row{display:flex;align-items:center;gap:12px}
    .avatar{width:56px;height:56px;border-radius:50%;object-fit:cover;border:1px solid rgba(226,232,240,.18)}
    .field{margin:12px 0}
    label{display:block;margin:0 0 8px;font-weight:600}
    input,select,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(226,232,240,.18);background:rgba(255,255,255,.06);color:#fff}
    textarea{resize:vertical}

    .overlay{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.35);backdrop-filter: blur(2px)}
    .overlay.hidden{display:none}
    .loader{display:grid;place-items:center;gap:10px;background:rgba(15,23,42,.9);border:1px solid rgba(226,232,240,.15);padding:16px 18px;border-radius:12px}
    .spin{animation:spin 1.2s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#121b2e;color:#fff;border:1px solid rgba(226,232,240,.18);padding:12px 16px;border-radius:12px;box-shadow:var(--shadow);opacity:0;pointer-events:none;transition:opacity .2s, transform .2s}
    .toast.show{opacity:1;transform:translate(-50%,0)}
    .sw-update{position:fixed;right:18px;bottom:18px;background:#121b2e;border:1px solid rgba(226,232,240,.18);padding:8px 10px;border-radius:10px;display:flex;align-items:center;gap:10px}
    .sw-update.hidden{display:none}
    .badge-chip{align-self:flex-start;background:rgba(96,165,250,.18);border:1px solid rgba(96,165,250,.35);border-radius:999px;padding:6px 10px}
  </style>
  <script>
    window.APP_VERSION = '1.0.0';
  </script>
  <script defer src="app.js"></script>
</head>
<body data-page="employee">
  <div class="bg-animated" aria-hidden="true">
    <canvas id="bg-light"></canvas>
    <div class="bg-gradient"></div>
  </div>

  <header class="appbar">
    <div class="appbar-left"><h1 class="brand">Presensi</h1></div>
    <div class="appbar-center"><div class="server-time" id="serverTime">—:—:—</div></div>
    <div class="appbar-right">
      <button id="notifBtn" class="icon-btn badge" aria-label="Notifikasi">
        <span class="material-symbols-rounded">notifications</span>
        <span id="notifBadge" class="badge-dot hidden"></span>
      </button>
      <button id="profileBtn" class="icon-btn" aria-label="Profil">
        <span class="material-symbols-rounded">account_circle</span>
      </button>
    </div>
  </header>

  <main class="container">
    <section class="card attendance-card">
      <header class="card-header">
        <div class="row between">
          <div>
            <h2>Presensi Hari Ini</h2>
            <p id="dayLabel" class="muted">—</p>
          </div>
          <div id="requireBadge" class="badge-chip">Wajib</div>
        </div>
      </header>

      <div class="grid-2">
        <div class="pane">
          <h3>Lokasi</h3>
          <p class="muted">Akurasi terbaik ≤ 50 m bila memungkinkan.</p>
          <div class="mapbox" id="miniMap" aria-label="Peta lokasi"></div>
          <div class="row gap" style="margin-top:10px">
            <button id="btnGetLocation" class="btn outline">
              <span class="material-symbols-rounded">my_location</span>
              Ambil lokasi
            </button>
            <div id="locStatus" class="status-dot">Menunggu…</div>
          </div>
          <p id="coordText" class="muted small">—</p>
        </div>

        <div class="pane">
          <h3>Kamera</h3>
          <div class="camera">
            <video id="cameraPreview" playsinline muted></video>
            <canvas id="frameA" class="hidden"></canvas>
            <canvas id="frameB" class="hidden"></canvas>
          </div>
          <div class="row gap" style="margin-top:10px">
            <button id="btnSnap" class="btn outline">
              <span class="material-symbols-rounded">photo_camera</span>
              Ambil foto
            </button>
            <label class="btn ghost">
              <span class="material-symbols-rounded">upload</span>
              Unggah galeri
              <input id="galleryInput" type="file" accept="image/*" hidden />
            </label>
          </div>
          <p id="privacyIndicator" class="muted small">Kamera & lokasi hanya aktif saat presensi.</p>
          <img id="photoPreview" class="photo-preview hidden" alt="Pratinjau foto" />
        </div>
      </div>

      <div class="pane">
        <h3>Jenis</h3>
        <div class="segmented">
          <input type="radio" id="typeIn" name="atype" value="in" checked />
          <label for="typeIn">Berangkat</label>
          <input type="radio" id="typeOut" name="atype" value="out" />
          <label for="typeOut">Pulang</label>
        </div>
      </div>

      <div class="pane">
        <div class="row between">
          <div class="window-status">
            <span id="windowLabel" class="chip green">Buka</span>
            <span id="statusLegend" class="legend">
              <span class="dot green"></span> Tepat
              <span class="dot yellow"></span> Terlambat
              <span class="dot red"></span> Alpa
            </span>
          </div>
          <div class="row gap">
            <button id="btnSubmitPresence" class="btn primary pulse" disabled>
              <span class="material-symbols-rounded">task_alt</span>
              Unggah presensi
            </button>
          </div>
        </div>
        <p id="nextChangeText" class="muted small">—</p>
      </div>

      <div class="pane">
        <h3>Riwayat singkat</h3>
        <div id="recentList" class="timeline"></div>
      </div>
    </section>

    <section class="card notifications-card">
      <header class="card-header"><h2>Notifikasi</h2></header>
      <div id="notifList" class="list"></div>
    </section>
  </main>

  <button id="fabLeave" class="fab" aria-label="Ajukan cuti">
    <span class="material-symbols-rounded">event_available</span>
  </button>

  <dialog id="profileDialog" class="modal">
    <form method="dialog" id="profileForm">
      <header class="modal-header">
        <h3>Profil</h3>
        <button class="icon-btn" value="cancel" aria-label="Tutup">
          <span class="material-symbols-rounded">close</span>
        </button>
      </header>
      <div class="modal-body">
        <div class="avatar-row">
          <img id="profilePhoto" class="avatar" alt="Foto profil" />
          <label class="btn ghost">
            <span class="material-symbols-rounded">add_a_photo</span>
            Ganti foto
            <input id="profilePhotoInput" type="file" accept="image/*" hidden />
          </label>
        </div>
        <div class="field">
          <label for="displayName">Nama</label>
          <input id="displayName" type="text" maxlength="80" />
        </div>
        <div class="field">
          <label for="address">Alamat</label>
          <input id="address" type="text" maxlength="160" />
        </div>
      </div>
      <footer class="modal-footer">
        <button class="btn ghost" id="logoutBtn" type="button">
          <span class="material-symbols-rounded">logout</span>
          Keluar
        </button>
        <div class="spacer"></div>
        <button class="btn" value="cancel">Batal</button>
        <button class="btn primary" id="saveProfileBtn" value="default">Simpan</button>
      </footer>
    </form>
  </dialog>

  <dialog id="leaveDialog" class="modal">
    <form method="dialog" id="leaveForm">
      <header class="modal-header">
        <h3>Ajukan cuti</h3>
        <button class="icon-btn" value="cancel" aria-label="Tutup">
          <span class="material-symbols-rounded">close</span>
        </button>
      </header>
      <div class="modal-body">
        <div class="field">
          <label for="leaveType">Jenis</label>
          <select id="leaveType" required>
            <option value="sakit">Sakit</option>
            <option value="izin">Izin</option>
            <option value="lainnya">Lainnya</option>
          </select>
        </div>
        <div class="grid-2">
          <div class="field">
            <label for="fromDate">Dari</label>
            <input id="fromDate" type="date" required />
          </div>
          <div class="field">
            <label for="toDate">Sampai</label>
            <input id="toDate" type="date" required />
          </div>
        </div>
        <div class="field">
          <label for="leaveReason">Keterangan</label>
          <textarea id="leaveReason" rows="3" maxlength="240"></textarea>
        </div>
      </div>
      <footer class="modal-footer">
        <button class="btn" value="cancel">Batal</button>
        <button class="btn primary" id="sendLeaveBtn" value="default">Kirim</button>
      </footer>
    </form>
  </dialog>

  <div id="overlay" class="overlay hidden" role="alert" aria-live="assertive">
    <div class="loader">
      <span class="material-symbols-rounded spin" aria-hidden="true">progress_activity</span>
      <p>Memproses…</p>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <div id="sw-update" class="sw-update hidden" role="status" aria-live="polite">
    <span>Tersedia versi baru.</span>
    <button id="reloadBtn" class="btn small">Muat versi baru</button>
  </div>
</body>
</html>